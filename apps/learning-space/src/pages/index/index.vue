<template>
  <tm-app>
    <view class="content">
      <a-hello-world></a-hello-world>
      <a-carousel></a-carousel>
      <WeappTailwindcss></WeappTailwindcss>
      <tm-qrcode ref="qrcode" :option="cfig"></tm-qrcode>
      <tm-icon
        color="red"
        :font-size="80"
        name="https://roundicons.com/wp-content/uploads/2017/09/PIzza-freebie-icon.png"></tm-icon>
      <tm-icon
        color="red"
        :font-size="80"
        name="https://roundicons.com/wp-content/uploads/2017/09/Rheindeer-freebie-icon.png"></tm-icon>
      <tm-icon
        color="red"
        :font-size="80"
        name="https://roundicons.com/wp-content/uploads/2017/09/Donut-freebie-icon.png"></tm-icon>
      <tm-icon rotate :font-size="50" name="tmicon-hongbao"></tm-icon>
      <view class="mt-[13.14758px]"></view>
      <view class="text-gray-900/50 mb-2 before:content-['å½“å‰ç³»ç»Ÿä¸»é¢˜:']">
        {{ themeRef }}ğŸ˜Š
      </view>
      <view class="space-y-[20rpx] flex flex-col items-center">
        <view
          class="bg-[#389f2bb1] h-16 w-16 rounded-[20rpx] text-white flex justify-center items-center after:content-['hover']"
          hover-class="!bg-[gray] after:!content-['good!']"></view>
        <view
          class="grid grid-cols-3 divide-x-[10px] divide-[#010101] divide-solid">
          <div :class="classArray">1</div>
          <div>2</div>
          <div :class="classArray">3</div>
        </view>
        <view
          class="w-32 py-2 rounded-md font-semibold text-white bg-pink-500 ring-4 ring-pink-300 text-center">
          Default
        </view>
        <view>
          <button
            class="text-[#fff] w-64"
            :class="buttonClass"
            @click="increment">
            click here to inc {{ count }}
          </button>
        </view>

        <view class="test">@apply</view>
        <view>
          <view
            class="ifdef-[MP-WEIXIN]:bg-blue-500 ifndef-[MP-WEIXIN]:bg-red-500">
            æ ·å¼çš„æ¡ä»¶ç¼–è¯‘:å¾®ä¿¡å°ç¨‹åºä¸ºè“è‰²ï¼Œä¸æ˜¯å¾®ä¿¡å°ç¨‹åºä¸ºçº¢è‰²
          </view>

          <view class="wx:bg-blue-500 -wx:bg-red-500">
            <view>è‡ªå®šä¹‰é…ç½®çš„æ–¹å¼è¿›è¡Œæ ·å¼æ¡ä»¶ç¼–è¯‘</view>
            <view>ç›¸å…³é…ç½®è§æ ¹ç›®å½•ä¸‹çš„tailwind.config.js</view>
          </view>

          <view class="apply-class-0">@apply æ¡ä»¶ç¼–è¯‘æ–¹å¼0</view>
          <view class="apply-class-1">@apply æ¡ä»¶ç¼–è¯‘æ–¹å¼1</view>
        </view>
      </view>

      <tm-sheet>
        <tm-text
          :font-size="30"
          color="red"
          _class="text-weight-b"
          label="3.0.89å¼€å§‹çœŸæ­£çš„å®ç°äº†æ‰€æœ‰å¹³å°çš„å…¼å®¹ï¼Œç‰¹åˆ«æ˜¯åœ¨nvueä¸‹é¢æ›´ä¸ºæµç•…ï¼Œæ€§èƒ½æ˜¯æœ€å¥½çš„ã€‚"></tm-text>
        <tm-text
          :font-size="24"
          label="è¿™é‡Œåªå±•ç¤ºéƒ¨åˆ†ï¼Œæ›´å¤šè¯·è§Echarts(5.3.2)å®˜ç½‘ç¤ºä¾‹ï¼Œå®˜ç½‘æ‰€æœ‰ç¤ºä¾‹å‡å¯ç”¨ã€‚åŒ…å¤§å°å¯ä»¥è‡ªè¡Œè£å‰ªã€‚ä»¥ä¸‹ç¤ºä¾‹ï¼Œä¸ºå®˜ç½‘å¤åˆ¶è¿‡æ¥,æ ·å¼å¯èƒ½ä¸å¤ªå¥½çœ‹ï¼Œè¯·è‡ªè¡Œé…ç½®å±æ€§ã€‚webpcä¹Ÿå…¼å®¹ "></tm-text>
        <tm-text
          :font-size="24"
          color="red"
          label="ç‰¹åˆ«å¼ºè°ƒï¼šç»„ä»¶ä»3.0.89å¼€å§‹å·²ç»å…¼å®¹äº†nvueç«¯echarts(5.4.3)ï¼Œä¸æ»‘å±•ç¤ºå›¾è¡¨ã€‚ä½†å› ä¸ºnvueæ˜¯æˆ‘æ˜ å°„çš„apiæ¥å£ï¼Œå› æ­¤åªæä¾›éƒ¨åˆ†æ¥å£ä¾›ä½ ä½¿ç”¨ã€‚å…·ä½“æ˜ å°„çš„æ¥å£æ•°é‡è§æ–‡æ¡£ã€‚"></tm-text>
        <!-- #ifdef MP -->
        <tm-text
          color="red"
          label="å°ç¨‹åºåŒ…è¶…è¿‡å¤§å°,ä¸æ¼”ç¤º,è¯·å‰å¾€h5æˆ–è€…appä¸­é¢„è§ˆæ•ˆæœ."></tm-text>
        <!-- #endif -->
      </tm-sheet>
      <tm-chart ref="chartDom" :height="400" @onInit="chartInit"></tm-chart>
      <!-- ä¸‹æ‹‰æ›´æ–°ï¼Œä¸Šæ‹‰åŠ è½½ -->
      <mescroll-body @init="mescrollInit" @down="downCallback" @up="upCallback">
        <view class="notice flex justify-center">
          mescrollçš„æç®€ç¤ºä¾‹,å¤§éƒ¨åˆ†æƒ…å†µå°±æ˜¯è¿™ä¹ˆç”¨
        </view>
        <good-list :list="goods"></good-list>
      </mescroll-body>
    </view>
  </tm-app>
</template>

<script setup lang="ts">
import WeappTailwindcss from '@/components/WeappTailwindcss.vue'
import GoodList from '@/components/GoodList.vue'
import { useCounterStore } from '@/stores/counter'
import { appName } from '@dcyjs/config'
import aCarousel from '@dcyjs/materials/components/a-carousel/a-carousel.vue'
import aHelloWorld from '@dcyjs/materials/components/a-hello-world/a-hello-world.vue'
import useMescroll from '@/uni_modules/mescroll-uni/hooks/useMescroll.js'
import { apiGoods } from '@/api/mock'
import tmApp from '@/tmui/components/tm-app/tm-app.vue'
import tmSheet from '@/tmui/components/tm-sheet/tm-sheet.vue'
import tmText from '@/tmui/components/tm-text/tm-text.vue'
import tmChart from '@/tmui/components/tm-chart/tm-chart.vue'
import tmQrcode from '@/tmui/components/tm-qrcode/tm-qrcode.vue'
import tmIcon from '@/tmui/components/tm-icon/tm-icon.vue'
import { ECharts } from 'echarts'

const cfig = { str: 'hello world' }

const goods = ref([]) // æ•°æ®åˆ—è¡¨
const { mescrollInit, downCallback } = useMescroll(onPageScroll, onReachBottom) // è°ƒç”¨mescrollçš„hook

// ä¸Šæ‹‰åŠ è½½çš„å›è°ƒ: å…¶ä¸­num:å½“å‰é¡µ ä»1å¼€å§‹, size:æ¯é¡µæ•°æ®æ¡æ•°,é»˜è®¤10
const upCallback = (mescroll: any) => {
  apiGoods(mescroll.num, mescroll.size)
    .then((res: any) => {
      const curPageData = res.list || [] // å½“å‰é¡µæ•°æ®
      if (mescroll.num === 1) goods.value = [] // ç¬¬ä¸€é¡µéœ€æ‰‹åŠ¨åˆ¶ç©ºåˆ—è¡¨
      goods.value = goods.value.concat(curPageData) // è¿½åŠ æ–°æ•°æ®
      // è”ç½‘æˆåŠŸçš„å›è°ƒ,éšè—ä¸‹æ‹‰åˆ·æ–°å’Œä¸Šæ‹‰åŠ è½½çš„çŠ¶æ€;
      // mescrollä¼šæ ¹æ®ä¼ çš„å‚æ•°,è‡ªåŠ¨åˆ¤æ–­åˆ—è¡¨å¦‚æœæ— ä»»ä½•æ•°æ®,åˆ™æç¤ºç©º;åˆ—è¡¨æ— ä¸‹ä¸€é¡µæ•°æ®,åˆ™æç¤ºæ— æ›´å¤šæ•°æ®;

      // æ–¹æ³•ä¸€(æ¨è): åå°æ¥å£æœ‰è¿”å›åˆ—è¡¨çš„æ€»é¡µæ•° totalPage
      // mescroll.endByPage(curPageData.length, totalPage); //å¿…ä¼ å‚æ•°(å½“å‰é¡µçš„æ•°æ®ä¸ªæ•°, æ€»é¡µæ•°)

      // æ–¹æ³•äºŒ(æ¨è): åå°æ¥å£æœ‰è¿”å›åˆ—è¡¨çš„æ€»æ•°æ®é‡ totalSize
      // mescroll.endBySize(curPageData.length, totalSize); //å¿…ä¼ å‚æ•°(å½“å‰é¡µçš„æ•°æ®ä¸ªæ•°, æ€»æ•°æ®é‡)

      // æ–¹æ³•ä¸‰(æ¨è): æ‚¨æœ‰å…¶ä»–æ–¹å¼çŸ¥é“æ˜¯å¦æœ‰ä¸‹ä¸€é¡µ hasNext
      // mescroll.endSuccess(curPageData.length, hasNext); //å¿…ä¼ å‚æ•°(å½“å‰é¡µçš„æ•°æ®ä¸ªæ•°, æ˜¯å¦æœ‰ä¸‹ä¸€é¡µtrue/false)

      // æ–¹æ³•å›› (ä¸æ¨è),ä¼šå­˜åœ¨ä¸€ä¸ªå°é—®é¢˜:æ¯”å¦‚åˆ—è¡¨å…±æœ‰20æ¡æ•°æ®,æ¯é¡µåŠ è½½10æ¡,å…±2é¡µ.å¦‚æœåªæ ¹æ®å½“å‰é¡µçš„æ•°æ®ä¸ªæ•°åˆ¤æ–­,åˆ™éœ€ç¿»åˆ°ç¬¬ä¸‰é¡µæ‰ä¼šçŸ¥é“æ— æ›´å¤šæ•°æ®.
      mescroll.endSuccess(curPageData.length) // è¯·æ±‚æˆåŠŸ, ç»“æŸåŠ è½½
    })
    .catch(() => {
      mescroll.endErr() // è¯·æ±‚å¤±è´¥, ç»“æŸåŠ è½½
    })
}

const chartOpt = ref({
  legend: {},
  tooltip: {
    trigger: 'axis',
    formatter(params: any) {
      return `${params[0].name}: ${params[0].value}`
    }
  },
  xAxis: {
    data: ['ç¬¬ä¸€å‘¨', 'ç¬¬äºŒå‘¨', 'ç¬¬ä¸‰å‘¨', 'ç¬¬å››å‘¨', 'ç¬¬äº”å‘¨', 'ç¬¬å…­å‘¨', 'ç¬¬ä¸ƒå‘¨']
  },
  yAxis: {},
  series: [
    {
      name: 'ææ–™ä¸€ç­',
      smooth: true,
      data: [10, 100, 20, 40, 60],
      type: 'line'
    },
    {
      name: 'ææ–™äºŒç­',
      type: 'line',
      smooth: true,
      data: [40, 10, 20, 40, 60],
      emphasis: {
        focus: 'series'
      }
    }
  ]
})

function chartInit(chart: ECharts) {
  chart.setOption(chartOpt.value)
}

console.log('AppName :', appName)

const store = useCounterStore()
const { count } = storeToRefs(store)
const { increment } = store
const buttonColors = [
  'bg-[#000]',
  'bg-[#111]',
  'bg-[#222]',
  'bg-[#333]',
  'bg-[#444]',
  'bg-[#555]',
  'bg-[#666]',
  'bg-[#777]',
  'bg-[#888]',
  'bg-[#999]',
  'bg-[#aaa]',
  'bg-[#bbb]',
  'bg-[#ccc]',
  'bg-[#ddd]',
  'bg-[#eee]',
  'bg-[#fff]'
]
const title = ref('Hello')
const themeRef = ref(uni.getSystemInfoSync().theme)
const classArray = computed(() => [
  title.value ? 'bg-[#ff00ff]' : undefined,
  {
    'text-[#00ffff]': Boolean(title),
    "bg-[url('https://xxx.com/xx.webp')]": true,
    "bg-[url('https://yyyy.com/ccc.webp')]": true
  }
])
const buttonClass = computed(() => {
  return buttonColors[count.value % buttonColors.length]
})
// #ifdef MP
uni.onThemeChange(({ theme }: { theme: 'dark' | 'light' }) => {
  themeRef.value = theme
})
// #endif
onBeforeUnmount(() => {
  // #ifdef MP
  uni.offThemeChange(() => {
    console.log('offThemeChange')
  })
  // #endif
})

onLoad(() => {
  console.log('æ¬¢è¿ä½¿ç”¨uni-app-vite-vue3-tailwindcssæ¨¡æ¿')
})
</script>

<style lang="scss" scoped>
.logo {
  @apply h-[100rpx] w-[100rpx];
}

.content {
  @apply flex flex-col items-center;
}

.test {
  @apply flex items-center justify-center h-[100px] w-[100px] rounded-[40px] bg-[#123456] bg-opacity-[0.54] text-[#ffffff] #{!important};
}

.apply-class-0 {
  @apply ifdef-[MP-WEIXIN]:bg-blue-500 ifndef-[MP-WEIXIN]:bg-red-500;
}

.apply-class-1 {
  // è¿™ä¸ªéœ€è¦åœ¨ tailwind.config.js é‡Œè¿›è¡Œè‡ªå®šä¹‰é…ç½®
  @apply wx:bg-blue-500 -wx:bg-red-500;
}
</style>
